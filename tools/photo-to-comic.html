<!--
TOOL_OVERVIEW_START
{
  "name": "Comic Style SVG Generator",
  "description": "A browser-based tool that converts images into comic-book style SVGs using OpenCV.js for edge detection and color smoothing.",
  "functionality": {
    "Image Transformation": "Applies adaptive thresholding and bilateral filtering to create bold outlines and simplified colors.",
    "SVG Export": "Generates a downloadable and copiable SVG file containing the processed image with posterization filters."
  },
  "dependencies": ["Tailwind CSS", "OpenCV.js", "Highlight.js"],
  "last_updated": "2025-12-29"
}
TOOL_OVERVIEW_END
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comic Style Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    
    <!-- Load OpenCV.js -->
    <script async src="https://docs.opencv.org/4.8.0/opencv.js" onload="onOpenCvReady()" type="text/javascript"></script>

    <style>
        .code-scroll::-webkit-scrollbar { height: 8px; width: 8px; }
        .code-scroll::-webkit-scrollbar-track { background: #1f2937; }
        .code-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -6px; 
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 2px;
        }
        /* Ensure SVG scales correctly inside its container */
        #svg-output svg {
            width: 100%;
            height: auto;
            max-height: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="p-1.5 bg-blue-600 rounded text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
                </div>
                <h1 class="text-lg font-bold text-gray-900">Comic Converter</h1>
            </div>
            <div id="status-container" class="flex items-center gap-2 text-sm font-medium text-amber-600">
                <div id="loader" class="loader"></div>
                <span id="status-text">Loading OpenCV...</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-6">
        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Column: Controls (4 cols) -->
            <div class="lg:col-span-4 space-y-5">
                
                <!-- 1. Upload -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3">1. Upload Photo</h2>
                    <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-colors group" id="drop-zone">
                        <input type="file" id="fileInput" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" disabled>
                        <div class="flex flex-col items-center pointer-events-none">
                            <svg class="w-8 h-8 text-gray-400 mb-2 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <span class="text-sm text-gray-600 font-medium">Click to upload</span>
                        </div>
                    </div>
                    <!-- Source Preview: Updated to Contain instead of Cover -->
                    <div id="source-preview-container" class="mt-4 hidden bg-gray-50 p-2 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-500 mb-2">Source Preview:</p>
                        <img id="source-preview-img" class="max-w-full max-h-60 h-auto object-contain mx-auto rounded">
                    </div>
                </div>

                <!-- 2. Settings -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-4">2. Tweak Style</h2>
                    
                    <div class="space-y-6">
                        <!-- Slider 1: Edge Detail -->
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <label class="font-medium text-gray-700">Edge Thickness</label>
                                <span id="val-edges" class="text-blue-600 font-mono">9</span>
                            </div>
                            <input type="range" id="input-edges" min="3" max="19" step="2" value="9">
                            <p class="text-xs text-gray-400 mt-1">Higher = fewer details, bolder lines</p>
                        </div>

                        <!-- Slider 2: Color Smoothing -->
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <label class="font-medium text-gray-700">Color Smoothness</label>
                                <span id="val-smooth" class="text-blue-600 font-mono">75</span>
                            </div>
                            <input type="range" id="input-smooth" min="10" max="150" step="10" value="75">
                            <p class="text-xs text-gray-400 mt-1">Higher = flatter, cartoon-like colors</p>
                        </div>

                        <!-- Slider 3: Color Levels -->
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <label class="font-medium text-gray-700">Color Palette Size</label>
                                <span id="val-levels" class="text-blue-600 font-mono">6</span>
                            </div>
                            <input type="range" id="input-levels" min="2" max="12" step="1" value="6">
                            <p class="text-xs text-gray-400 mt-1">Number of distinct colors in output</p>
                        </div>
                    </div>

                    <!-- Convert Button -->
                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <button id="convert-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                            <span>Convert Image</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Output (8 cols) -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Preview: Updated to be flexible height and contain SVG -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col h-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide">3. Result</h2>
                        <button id="download-btn" class="hidden text-sm px-3 py-1.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition flex items-center gap-2 font-medium">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download SVG
                        </button>
                    </div>

                    <!-- Main Preview Container -->
                    <div id="preview-container" class="w-full flex justify-center items-center bg-gray-50 rounded-lg border border-gray-200 overflow-hidden relative p-4 min-h-[300px]">
                        <p class="text-gray-400 italic" id="empty-state-text">Upload an image and click Convert</p>
                        <!-- SVG Output Container - scales content inside -->
                        <div id="svg-output" class="hidden shadow-xl w-full flex justify-center"></div>
                    </div>
                </div>

                <!-- Code View -->
                <div class="bg-gray-900 rounded-xl shadow-sm border border-gray-800 overflow-hidden">
                    <div class="bg-gray-800 px-4 py-2 flex justify-between items-center border-b border-gray-700">
                        <span class="text-xs font-mono text-gray-400">output.svg</span>
                        <button id="copy-btn" class="text-xs text-white bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded transition flex items-center gap-1" disabled>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                            Copy Code
                        </button>
                    </div>
                    <div class="relative">
                        <pre><code class="language-xml code-scroll max-h-[200px] text-sm overflow-auto" id="code-block">&lt;!-- SVG code will appear here --&gt;</code></pre>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Hidden Elements for Processing -->
    <canvas id="canvas-processing" class="hidden"></canvas>
    <img id="image-src" class="hidden">

    <script type="text/javascript">
        let cvReady = false;
        
        // UI Elements
        const statusText = document.getElementById('status-text');
        const loader = document.getElementById('loader');
        const fileInput = document.getElementById('fileInput');
        const sourcePreviewImg = document.getElementById('source-preview-img');
        const sourcePreviewContainer = document.getElementById('source-preview-container');
        const convertBtn = document.getElementById('convert-btn');
        const emptyStateText = document.getElementById('empty-state-text');
        const svgOutput = document.getElementById('svg-output');
        const codeBlock = document.getElementById('code-block');
        const copyBtn = document.getElementById('copy-btn');
        const downloadBtn = document.getElementById('download-btn');
        const imgElement = document.getElementById('image-src');

        // Inputs
        const inputEdges = document.getElementById('input-edges');
        const inputSmooth = document.getElementById('input-smooth');
        const inputLevels = document.getElementById('input-levels');
        
        // Display Values
        const valEdges = document.getElementById('val-edges');
        const valSmooth = document.getElementById('val-smooth');
        const valLevels = document.getElementById('val-levels');

        // Link Sliders to Display Values
        inputEdges.oninput = () => valEdges.textContent = inputEdges.value;
        inputSmooth.oninput = () => valSmooth.textContent = inputSmooth.value;
        inputLevels.oninput = () => valLevels.textContent = inputLevels.value;

        // 1. Initialize OpenCV
        function onOpenCvReady() {
            cv['onRuntimeInitialized'] = () => {
                cvReady = true;
                statusText.innerText = "Ready";
                statusText.classList.remove('text-amber-600');
                statusText.classList.add('text-green-600');
                loader.style.display = 'none';
                fileInput.disabled = false;
            };
        }

        // 2. Handle File Selection
        fileInput.addEventListener('change', (e) => {
            if (!e.target.files[0]) return;
            
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                // Set hidden source
                imgElement.src = event.target.result;
                
                // Set visible preview
                sourcePreviewImg.src = event.target.result;
                sourcePreviewContainer.classList.remove('hidden');
                
                // Enable convert button once image loads
                imgElement.onload = function() {
                    convertBtn.disabled = false;
                    convertBtn.classList.remove('opacity-50');
                }
            };
            reader.readAsDataURL(file);
        });

        // 3. Trigger Conversion
        convertBtn.addEventListener('click', () => {
            if(!cvReady) return;
            
            // Set UI to loading state
            convertBtn.disabled = true;
            convertBtn.innerHTML = `<span class="loader border-t-white border-2 w-4 h-4"></span> Processing...`;
            statusText.innerText = "Processing...";
            loader.style.display = 'block';

            // Allow UI to update before blocking main thread
            setTimeout(() => {
                try {
                    processImage();
                } catch (err) {
                    console.error(err);
                    alert("Error: " + err);
                } finally {
                    // Reset UI
                    convertBtn.disabled = false;
                    convertBtn.innerHTML = `
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <span>Convert Image</span>
                    `;
                    statusText.innerText = "Done";
                    loader.style.display = 'none';
                }
            }, 50);
        });

        // 4. Image Processing Logic
        function processImage() {
            let src = cv.imread(imgElement);
            
            // Resize if too large (improves performance significantly)
            let maxDim = 800;
            let scaleFactor = 1.0;
            if(src.cols > maxDim || src.rows > maxDim) {
                scaleFactor = maxDim / Math.max(src.cols, src.rows);
                let newSize = new cv.Size(src.cols * scaleFactor, src.rows * scaleFactor);
                cv.resize(src, src, newSize, 0, 0, cv.INTER_AREA);
            }

            // Get Settings
            const blockSize = parseInt(inputEdges.value); // Must be odd
            const smoothVal = parseInt(inputSmooth.value);
            const numColors = parseInt(inputLevels.value);

            // A. Prepare Edges
            let gray = new cv.Mat();
            cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
            
            // Median Blur (reduce noise before edge detection)
            cv.medianBlur(gray, gray, 5);
            
            // Adaptive Threshold for Edges
            let edges = new cv.Mat();
            // blockSize, C (constant subtracted)
            cv.adaptiveThreshold(gray, edges, 255, cv.ADAPTIVE_THRESH_MEAN_C, cv.THRESH_BINARY, blockSize, 5);
            
            // B. Prepare Color (Bilateral Filter)
            let color = new cv.Mat();
            cv.cvtColor(src, color, cv.COLOR_RGBA2RGB); 
            
            // Smooth Colors
            let tempColor = new cv.Mat();
            cv.bilateralFilter(color, tempColor, 9, smoothVal, smoothVal);
            tempColor.copyTo(color);
            
            // C. Combine Edges and Color
            let edgesColor = new cv.Mat();
            cv.cvtColor(edges, edgesColor, cv.COLOR_GRAY2RGB);
            
            let cartoon = new cv.Mat();
            cv.bitwise_and(color, edgesColor, cartoon);

            // D. Generate Output
            cv.imshow('canvas-processing', cartoon);
            const canvas = document.getElementById('canvas-processing');
            const dataUrl = canvas.toDataURL('image/png');
            
            generateSvg(dataUrl, cartoon.cols, cartoon.rows, numColors);

            // Cleanup
            src.delete(); gray.delete(); edges.delete();
            color.delete(); tempColor.delete(); edgesColor.delete();
            cartoon.delete();
        }

        function generateSvg(base64Image, width, height, numColors) {
            // Generate posterization table values
            // Generates sequence like "0 0.33 0.66 1" for 4 colors
            let tableValues = [];
            for(let i=0; i<numColors; i++) {
                tableValues.push((i / (numColors - 1)).toFixed(2));
            }
            const tableStr = tableValues.join(' ');

            // SVG Logic: 
            // 1. ViewBox defines aspect ratio.
            // 2. preserveAspectRatio="xMidYMid meet" scales to fit.
            // 3. style="width: 100%; height: auto;" makes it responsive in CSS.
            const svgString = `<svg viewBox="0 0 ${width} ${height}" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: auto;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <desc>Comic Style Image</desc>
  <defs>
    <filter id="posterize">
      <feComponentTransfer>
         <feFuncR type="discrete" tableValues="${tableStr}"/>
         <feFuncG type="discrete" tableValues="${tableStr}"/>
         <feFuncB type="discrete" tableValues="${tableStr}"/>
      </feComponentTransfer>
    </filter>
  </defs>
  <image width="${width}" height="${height}" href="${base64Image}" filter="url(#posterize)"/>
</svg>`;

            // Update UI
            emptyStateText.style.display = 'none';
            svgOutput.style.display = 'flex'; // Changed to flex for centering
            svgOutput.innerHTML = svgString;
            
            // Update Code Block
            codeBlock.textContent = svgString;
            hljs.highlightElement(codeBlock);
            
            // Enable Actions
            copyBtn.disabled = false;
            downloadBtn.classList.remove('hidden');
            
            downloadBtn.onclick = () => {
                const blob = new Blob([svgString], {type: 'image/svg+xml'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'comic_style.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            copyBtn.onclick = () => {
                navigator.clipboard.writeText(svgString).then(() => {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = `<span class="text-green-400">Copied!</span>`;
                    setTimeout(() => copyBtn.innerHTML = originalText, 2000);
                });
            };
        }
    </script>
</body>
</html>


